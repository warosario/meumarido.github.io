<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>PWA Push</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007aff">
</head>
<body>
  <h1>ðŸ”” PWA Push Notifications</h1>
  <button id="subscribeBtn">Ativar NotificaÃ§Ãµes</button>

  <script>
    const publicVapidKey = "BFPmV--eH6xVPgAnKyCgEFr_k7uXtgn25KkY4sVfS4HLNh6_SLDDHpP8pIbFMEAWCu9rMPvMZ9PWieicH9oRPUg";

    // registra o SW e pede inscriÃ§Ã£o push
    async function subscribe() {
      if ("serviceWorker" in navigator) {
        const reg = await navigator.serviceWorker.register("service-worker.js");

        const subscription = await reg.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
        });

        console.log("SubscriÃ§Ã£o push:", JSON.stringify(subscription));
        // Aqui vocÃª envia subscription para seu servidor
        await fetch("/subscribe", {
          method: "POST",
          body: JSON.stringify(subscription),
          headers: { "Content-Type": "application/json" }
        });
      }
    }

    document.getElementById("subscribeBtn").addEventListener("click", async () => {
      const perm = await Notification.requestPermission();
      if (perm === "granted") {
        subscribe();
      }
    });

    function urlBase64ToUint8Array(base64String) {
      const padding = "=".repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/\-/g, "+").replace(/_/g, "/");
      const rawData = window.atob(base64);
      const outputArray = new Uint8Array(rawData.length);
      for (let i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
      }
      return outputArray;
    }
  </script>
</body>
</html>
